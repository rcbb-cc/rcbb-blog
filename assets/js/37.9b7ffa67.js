(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{380:function(n,e,o){"use strict";o.r(e);var a=o(1),s=Object(a.a)({},(function(){var n=this,e=n._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h1",{attrs:{id:"nacos容器化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nacos容器化"}},[n._v("#")]),n._v(" Nacos容器化")]),n._v(" "),e("p",[n._v("Nacos 容器化，因为修改了 Nacos 源码（使其支持 PostgreSQL），所以需要构建自己的镜像。")]),n._v(" "),e("h2",{attrs:{id:"官网资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#官网资料"}},[n._v("#")]),n._v(" 官网资料")]),n._v(" "),e("p",[n._v("官网提供的下载链接："),e("a",{attrs:{href:"https://github.com/alibaba/nacos/releases",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://github.com/alibaba/nacos/releases"),e("OutboundLink")],1)]),n._v(" "),e("p",[n._v("下载一个官网提供的构造"),e("code",[n._v("nacos docker")]),n._v("镜像的源码，然后根据自己的需求改动。")]),n._v(" "),e("p",[n._v("官网链接："),e("a",{attrs:{href:"https://nacos.io/zh-cn/docs/quick-start-docker.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://nacos.io/zh-cn/docs/quick-start-docker.html"),e("OutboundLink")],1)]),n._v(" "),e("p",[n._v("源码链接："),e("a",{attrs:{href:"https://github.com/nacos-group/nacos-docker.git",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://github.com/nacos-group/nacos-docker.git"),e("OutboundLink")],1)]),n._v(" "),e("p",[n._v("文件的结构说明：")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[n._v("nacos-docker-master\n|----build：nacos 镜像制作的源码\n    |----bin：shell脚本\n    |----conf：配置文件\n|----env: docker compose 环境变量文件\n|----example: docker-compose编排例子\n")])])]),e("h2",{attrs:{id:"自定义"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自定义"}},[n._v("#")]),n._v(" 自定义")]),n._v(" "),e("p",[n._v("我使用的版本是"),e("code",[n._v("2.0.4")]),n._v("。")]),n._v(" "),e("h3",{attrs:{id:"dockerfile"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[n._v("#")]),n._v(" Dockerfile")]),n._v(" "),e("p",[n._v("修改"),e("code",[n._v("Dockerfile")]),n._v("文件的内容：")]),n._v(" "),e("ol",[e("li",[e("code",[n._v("NACOS_VERSION")]),n._v("该为自己要使用的版本；")])]),n._v(" "),e("blockquote",[e("p",[n._v("ARG NACOS_VERSION=2.0.4")])]),n._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[n._v("将自己打好的包放到"),e("code",[n._v("build")]),n._v("文件夹中。")])]),n._v(" "),e("blockquote",[e("p",[n._v("COPY nacos-server-2.0.4.tar.gz /home")])]),n._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[n._v("删除从网络获取的命令。")])]),n._v(" "),e("p",[e("img",{attrs:{src:"https://rcbb-blog.oss-cn-guangzhou.aliyuncs.com/2022/11/20221109170147-4b2bbf.png?x-oss-process=style/yuantu_shuiyin",alt:"Dockerfile"}})]),n._v(" "),e("p",[n._v("Dockerfile 完整内容。")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[n._v('FROM centos:7.9.2009\nMAINTAINER pader "huangmnlove@163.com"\n\n# set environment\nENV MODE="standalone" \\\n    PREFER_HOST_MODE="ip"\\\n    BASE_DIR="/home/nacos" \\\n    CLASSPATH=".:/home/nacos/conf:$CLASSPATH" \\\n    CLUSTER_CONF="/home/nacos/conf/cluster.conf" \\\n    FUNCTION_MODE="all" \\\n    JAVA_HOME="/usr/lib/jvm/java-1.8.0-openjdk" \\\n    NACOS_USER="nacos" \\\n    JAVA="/usr/lib/jvm/java-1.8.0-openjdk/bin/java" \\\n    JVM_XMS="1g" \\\n    JVM_XMX="1g" \\\n    JVM_XMN="512m" \\\n    JVM_MS="128m" \\\n    JVM_MMS="320m" \\\n    NACOS_DEBUG="n" \\\n    TOMCAT_ACCESSLOG_ENABLED="false" \\\n    TIME_ZONE="Asia/Shanghai"\n\nARG NACOS_VERSION=2.0.4\nARG HOT_FIX_FLAG=""\n\nWORKDIR $BASE_DIR\n\nCOPY nacos-server-2.0.4.tar.gz /home\n\nRUN set -x \\\n    && yum update -y \\\n    && yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel wget iputils nc vim libcurl\nRUN tar -xzvf /home/nacos-server-${NACOS_VERSION}.tar.gz -C /home \\\n    && rm -rf /home/nacos-server-${NACOS_VERSION}.tar.gz /home/nacos/bin/* /home/nacos/conf/*.properties /home/nacos/conf/*.example /home/nacos/conf/nacos-mysql.sql\nRUN yum autoremove -y wget \\\n    && ln -snf /usr/share/zoneinfo/$TIME_ZONE /etc/localtime && echo $TIME_ZONE > /etc/timezone \\\n    && yum clean all\n\n\n\n\nADD bin/docker-startup.sh bin/docker-startup.sh\nADD conf/application.properties conf/application.properties\n\n\n# set startup log dir\nRUN mkdir -p logs \\\n\t&& cd logs \\\n\t&& touch start.out \\\n\t&& ln -sf /dev/stdout start.out \\\n\t&& ln -sf /dev/stderr start.out\nRUN chmod +x bin/docker-startup.sh\n\nEXPOSE 8848\nENTRYPOINT ["bin/docker-startup.sh"]\n')])])]),e("h3",{attrs:{id:"config"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#config"}},[n._v("#")]),n._v(" config")]),n._v(" "),e("p",[n._v("修改连接数据库的配置。")]),n._v(" "),e("h3",{attrs:{id:"构建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[n._v("#")]),n._v(" 构建")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[n._v("(1)cd到build文件夹\n    \n(2)构建命令\n    docker build -t nacos-2.0.4 .\n")])])]),e("h3",{attrs:{id:"docker-compose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[n._v("#")]),n._v(" docker-compose")]),n._v(" "),e("p",[n._v("官方 example 文件夹中有 docker-compose 编排例子。")]),n._v(" "),e("p",[n._v("需要根据自己的使用去修改。")]),n._v(" "),e("p",[n._v("例如，我的需求是单机启动，然后使用自己的"),e("code",[n._v("2.0.4")]),n._v("版本的镜像。")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[n._v('version: "3"\nservices:\n  nacos:\n    image: nacos:2.0.4\n    container_name: nacos\n    environment:\n      - PREFER_HOST_MODE=hostname\n      - MODE=standalone\n    volumes:\n      - /home/nacos/logs:/home/nacos/logs\n    ports:\n      - "8848:8848"\n      - "9848:9848"\n    network_mode: "host"\n')])])])])}),[],!1,null,null,null);e.default=s.exports}}]);