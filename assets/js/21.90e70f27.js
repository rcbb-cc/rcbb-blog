(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{362:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[s._v("#")]),s._v(" 概念")]),s._v(" "),a("h3",{attrs:{id:"什么是flyway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是flyway"}},[s._v("#")]),s._v(" 什么是Flyway")]),s._v(" "),a("p",[s._v("Flyway 是一个能对数据库变更做版本控制的工具。")]),s._v(" "),a("h3",{attrs:{id:"为什么要用flyway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么要用flyway"}},[s._v("#")]),s._v(" 为什么要用Flyway")]),s._v(" "),a("p",[s._v("在多人开发的项目中，我们都习惯了使用 SVN 或者 Git 来对代码做版本控制，主要的目的就是为了解决多人开发代码冲突和版本回退的问题。")]),s._v(" "),a("p",[s._v("其实，数据库的变更也需要版本控制，在日常开发中，我们经常会遇到下面的问题：")]),s._v(" "),a("ol",[a("li",[s._v("自己写的 SQL 忘了在所有环境执行；")]),s._v(" "),a("li",[s._v("别人写的 SQL 我们不能确定是否都在所有环境执行过了；")]),s._v(" "),a("li",[s._v("有人修改了已经执行过的 SQL，期望再次执行；")]),s._v(" "),a("li",[s._v("需要新增环境做数据迁移；")]),s._v(" "),a("li",[s._v("每次发版需要手动控制先发 DB 版本，再发布应用版本；")]),s._v(" "),a("li",[s._v("其它场景...")])]),s._v(" "),a("p",[s._v("有了Flyway，这些问题都能得到很好的解决。")]),s._v(" "),a("h3",{attrs:{id:"flyway的特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flyway的特点"}},[s._v("#")]),s._v(" Flyway的特点")]),s._v(" "),a("ul",[a("li",[s._v("简单。非常容易安装和学习，同时迁移的方式也很容易被开发者接受。")]),s._v(" "),a("li",[s._v("转移。Flyway 专注于搞数据库迁移、版本控制而并没有其它副作用。")]),s._v(" "),a("li",[s._v("强大。专为连续交付而设计。让Flyway在应用程序启动时迁移数据库。")])]),s._v(" "),a("h3",{attrs:{id:"flyway的工作机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flyway的工作机制"}},[s._v("#")]),s._v(" Flyway的工作机制")]),s._v(" "),a("p",[s._v("Flyway 需要在 DB 中先创建一个 metadata 表 (缺省表名为 "),a("code",[s._v("flyway_schema_history")]),s._v("), 在该表中保存着每次 migration （迁移）的记录, 记录包含 migration 脚本的版本号和 SQL 脚本的 checksum 值。")]),s._v(" "),a("p",[s._v("Flyway 扫描文件系统或应用程序的类路径读取 DDL 和 DML 以进行迁移。"),a("br"),s._v("\n根据metadata 表进行检查迁移。"),a("br"),s._v(" "),a("strong",[s._v("如果脚本声明的版本号小于或等于标记为当前版本的版本号之一，将忽略它们")]),s._v("。"),a("br"),s._v("\n其余迁移是待处理迁移：可用，但未应用。最后按版本号对它们进行排序并按顺序执行 并将执行结果写入 metadata 表。")]),s._v(" "),a("h2",{attrs:{id:"最佳实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最佳实践"}},[s._v("#")]),s._v(" 最佳实践")]),s._v(" "),a("p",[s._v("通过 "),a("a",{attrs:{href:"https://start.aliyun.com/bootstrap.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Aliyun Java Initializr"),a("OutboundLink")],1),s._v(" 创建项目")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://rcbb-blog.oss-cn-guangzhou.aliyuncs.com/2022/04/20220416100653-89c795.png?x-oss-process=style/yuantu_shuiyin",alt:"依赖"}})]),s._v(" "),a("p",[s._v("我使用的是 PostgreSQL，创建一个库。")]),s._v(" "),a("blockquote",[a("p",[s._v("create database test_flyway;")])]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("src/main/resources")]),s._v("目录下面新建"),a("code",[s._v("db.migration")]),s._v("文件夹，默认情况下，该目录下的.sql 文件就算是需要被 flyway 做版本控制的数据库 SQL 语句。")]),s._v(" "),a("p",[s._v("但是此处的 SQL 语句命名需要遵从一定的规范，否则运行的时候 flyway 会报错。命名规则主要有两种：")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("仅需被执行一次的 SQL")]),s._v(" 。文件命名以大写"),a("code",[s._v("V")]),s._v("字开头，后面可跟上"),a("code",[s._v("0-9")]),s._v("数字，数字之间可用"),a("code",[s._v(".")]),s._v("或"),a("code",[s._v("_")]),s._v("分隔开，然后再以"),a("strong",[s._v("两个下划线")]),s._v("分隔，后面为文件名，最后以"),a("code",[s._v(".sql")]),s._v("结尾。例："),a("code",[s._v("V1.0.0__init.sql")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("可重复运行的SQL")]),s._v("。只要脚本内容发生了变化，项目启动时脚本就会被重新执行。文件名以大写"),a("code",[s._v("R")]),s._v("字开头，后面再以两个下划线分隔后面为文件名，最后以"),a("code",[s._v(".sql")]),s._v("结尾。")])])]),s._v(" "),a("p",[s._v("项目配置。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flyway"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("test\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("datasource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("driver-class-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" org.postgresql.Driver\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jdbc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("postgresql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//192.168.1.56"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("5432/test_flyway"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("&ssl=false&stringtype=unspecified")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" postgres\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" postgres\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("初次启动，报错。因为无任何内容。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://rcbb-blog.oss-cn-guangzhou.aliyuncs.com/2022/04/20220416102645-c2a0f3.png?x-oss-process=style/yuantu_shuiyin",alt:"初次启动，报错"}})]),s._v(" "),a("h3",{attrs:{id:"仅需被执行一次的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#仅需被执行一次的"}},[s._v("#")]),s._v(" 仅需被执行一次的")]),s._v(" "),a("p",[s._v("文件命名以大写"),a("code",[s._v("V")]),s._v("字开头，后面可跟上"),a("code",[s._v("0-9")]),s._v("数字，数字之间可用"),a("code",[s._v(".")]),s._v("或"),a("code",[s._v("_")]),s._v("分隔开，然后再以"),a("strong",[s._v("两个下划线")]),s._v("分隔，后面为文件名，最后以"),a("code",[s._v(".sql")]),s._v("结尾。例："),a("code",[s._v("V1.0.0__init.sql")])]),s._v(" "),a("p",[s._v("创建第一个脚本："),a("code",[s._v("V1.0.0_init.sql")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tb_user\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    id          bigserial "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    username    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    nickname    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    age         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("smallint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    create_time "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    update_time "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tb_user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户表'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" tb_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户ID'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" tb_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户名'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" tb_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("nickname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户昵称'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" tb_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("age "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'年龄'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" tb_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("create_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'创建时间'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" tb_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'更新时间'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://rcbb-blog.oss-cn-guangzhou.aliyuncs.com/2022/04/20220426145200-3f8d93.png?x-oss-process=style/yuantu_shuiyin",alt:"目录结构"}})]),s._v(" "),a("p",[s._v("我在 "),a("code",[s._v("db.migration")]),s._v(" 下还创建了一个 1.0.0 的文件夹，这个不会影响 flyway 对 sql 的识别，可以自行取名和分类。")]),s._v(" "),a("p",[s._v("运行成功。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://rcbb-blog.oss-cn-guangzhou.aliyuncs.com/2022/04/20220426145647-1671cc.png?x-oss-process=style/yuantu_shuiyin",alt:"运行成功"}})]),s._v(" "),a("p",[s._v("创建了"),a("code",[s._v("flyway_schema_history")]),s._v("表，并成功执行一个脚本。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://rcbb-blog.oss-cn-guangzhou.aliyuncs.com/2022/04/20220426145954-9e8553.png?x-oss-process=style/yuantu_shuiyin",alt:"数据库内容"}})]),s._v(" "),a("p",[a("code",[s._v("flyway_schema_history")]),s._v("表中记录的是脚本信息和脚本执行状态。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://rcbb-blog.oss-cn-guangzhou.aliyuncs.com/2022/04/20220426145919-9db8f9.png?x-oss-process=style/yuantu_shuiyin",alt:"flyway_schema_history"}})]),s._v(" "),a("p",[s._v("有了这条记录，下次再启动项目，"),a("code",[s._v("1.0.0/V1.0.0__init.sql")]),s._v(" 这个脚本文件就不会执行了，因为系统知道这个脚本已经执行过了。"),a("br"),s._v("\n如果你还想让 "),a("code",[s._v("1.0.0/V1.0.0__init.sql")]),s._v("脚本再执行一遍，需要手动删除"),a("code",[s._v("flyway_schema_history")]),s._v("  表中的对应记录，那么项目启动时，这个脚本就会被执行了。")]),s._v(" "),a("h3",{attrs:{id:"可重复执行的脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可重复执行的脚本"}},[s._v("#")]),s._v(" 可重复执行的脚本")]),s._v(" "),a("p",[s._v("只要脚本内容发生了变化，项目启动时脚本就会被重新执行。文件名以大写"),a("code",[s._v("R")]),s._v("字开头，后面再以两个下划线分隔后面为文件名，最后以"),a("code",[s._v(".sql")]),s._v("结尾。")]),s._v(" "),a("p",[s._v("接着在 "),a("code",[s._v("db/migration/1.0.0/")]),s._v("下创建"),a("code",[s._v("R__init_user.sql")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" tb_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nickname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" tb_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nickname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sys'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sys'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("重新启动项目，运行成功。"),a("br"),s._v("\n数据库"),a("code",[s._v("tb_user")]),s._v("表中新增两条数据。"),a("br"),s._v(" "),a("code",[s._v("flyway_schema_history")]),s._v("新增了一条记录，但 version 字段上为 null。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://rcbb-blog.oss-cn-guangzhou.aliyuncs.com/2022/04/20220426151708-8b7aab.png?x-oss-process=style/yuantu_shuiyin",alt:"flyway_schema_history"}})]),s._v(" "),a("p",[s._v("重新运行程序第二遍，并未发生变化。")]),s._v(" "),a("p",[s._v("重新修改"),a("code",[s._v("R__init_user.sql")]),s._v(" 脚本。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" tb_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nickname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("重新运行程序，脚本执行成功，数据变更成功。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://rcbb-blog.oss-cn-guangzhou.aliyuncs.com/2022/04/20220426152833-f7de31.png?x-oss-process=style/yuantu_shuiyin",alt:"tb_user"}})]),s._v(" "),a("h2",{attrs:{id:"错误验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误验证"}},[s._v("#")]),s._v(" 错误验证")]),s._v(" "),a("h3",{attrs:{id:"刻意修改仅需被执行一次的脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#刻意修改仅需被执行一次的脚本"}},[s._v("#")]),s._v(" 刻意修改仅需被执行一次的脚本")]),s._v(" "),a("p",[s._v("当直接在"),a("code",[s._v("V1.0.0__init.sql")]),s._v("脚本上进行修改时。重新启动程序会进行报错。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://rcbb-blog.oss-cn-guangzhou.aliyuncs.com/2022/04/20220426153132-e37ecd.png?x-oss-process=style/yuantu_shuiyin",alt:"报错"}})]),s._v(" "),a("p",[s._v("原因：会检查数据库中对应脚本的"),a("code",[s._v("checksum")]),s._v("字段，发现不对应则说明脚本进行了修改，所以阻止运行。")]),s._v(" "),a("p",[s._v("将修改的内容还原，则可重新运行。"),a("br"),s._v("\n或者删除"),a("code",[s._v("flyway_schema_history")]),s._v("表中"),a("code",[s._v("V1.0.0__init.sql")]),s._v("脚本对应的记录，则可重新执行"),a("code",[s._v("V1.0.0__init.sql")]),s._v("脚本。")]),s._v(" "),a("h3",{attrs:{id:"可重复执行的脚本若存在错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可重复执行的脚本若存在错误"}},[s._v("#")]),s._v(" 可重复执行的脚本若存在错误")]),s._v(" "),a("p",[s._v("刻意在"),a("code",[s._v("R__init_user.sql")]),s._v("脚本中添加一条错误的脚本，让其"),a("code",[s._v("id")]),s._v("与库中已存在的数据冲突。")]),s._v(" "),a("p",[s._v("顺便验证数据是否会回滚。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" tb_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nickname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" tb_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nickname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" tb_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nickname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("从报错信息中能很明显的看出来问题，直接给出了具体的语句和错误原因。"),a("br"),s._v("\n然后上面的语句也未成功添加。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://rcbb-blog.oss-cn-guangzhou.aliyuncs.com/2022/04/20220426154032-2e57e6.png?x-oss-process=style/yuantu_shuiyin",alt:"报错信息"}})]),s._v(" "),a("h2",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),a("ol",[a("li",[s._v("生产务必禁 spring.flyway.cleanDisabled=false 。")]),s._v(" "),a("li",[s._v("spring.flyway.outOfOrder 取值 生产上使用 true，开发中使用 false。")]),s._v(" "),a("li",[s._v("多个系统公用一个 数据库 schema 时配置spring.flyway.table 为不同的系统设置不同的 metadata 表名而不使用缺省值 "),a("code",[s._v("flyway_schema_history")]),s._v(" 。")]),s._v(" "),a("li",[s._v("开发版本号尽量根据团队来进行多层次的命名避免混乱。比如 "),a("code",[s._v("V1.0.1__ProjectName_{feat|fix}_Description.sql")]),s._v(" ，这种命名同时也可以获取更多脚本的开发者和相关功能的信息。")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# flyway 配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("flyway")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启用或禁用 flyway")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# flyway 的 clean 命令会删除指定 schema 下的所有 table, 生产务必禁掉。这个默认值是 false 理论上作为默认配置是不科学的。")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clean-disabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SQL 脚本的目录,多个路径使用逗号分隔 默认值 classpath:db/migration")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("locations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" classpath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("db/migration\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  metadata 版本控制信息表 默认 flyway_schema_history")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flyway_schema_history\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果没有 flyway_schema_history 这个 metadata 表， 在执行 flyway migrate 命令之前, 必须先执行 flyway baseline 命令")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置为 true 后 flyway 将在需要 baseline 的时候, 自动执行一次 baseline。")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("baseline-on-migrate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定 baseline 的版本号,默认值为 1, 低于该版本号的 SQL 文件, migrate 时会被忽略")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("baseline-version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 字符编码 默认 UTF-8")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("encoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" UTF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许不按顺序迁移 开发建议 false  生产建议 ture")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("out-of-order")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要 flyway 管控的 schema list,这里我们配置为flyway  缺省的话, 使用spring.datasource.url 配置的那个 schema,")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以指定多个schema, 但仅会在第一个schema下建立 metadata 表, 也仅在第一个schema应用migration sql 脚本.")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 但flyway Clean 命令会依次在这些schema下都执行一遍. 所以 确保生产 spring.flyway.clean-disabled 为 true")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schemas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" flyway\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行迁移时是否自动调用验证   当你的 版本不符合逻辑 比如 你先执行了 DML 而没有 对应的DDL 会抛出异常")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("validate-on-migrate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[s._v("配置全路径"),a("code",[s._v("org.springframework.boot.autoconfigure.flyway.FlywayProperties")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("flyway.baseline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("description对执行迁移时基准版本的描述.\nflyway.baseline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("migrate当迁移时发现目标schema非空，而且带有没有元数据的表时，是否自动执行基准迁移，默认false.\nflyway.baseline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("version开始执行基准迁移时对现有的schema的版本打标签，默认值为1.\nflyway.check"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("location检查迁移脚本的位置是否存在，默认false.\nflyway.clean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("validation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("error当发现校验错误时是否自动调用clean，默认false.\nflyway.enabled是否开启flywary，默认true.\nflyway.encoding设置迁移时的编码，默认UTF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.")]),s._v("\nflyway.ignore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("failed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("future"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("migration当读取元数据表时是否忽略错误的迁移，默认false.\nflyway.init"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("sqls当初始化好连接时要执行的SQL.\nflyway.locations迁移脚本的位置，默认db/migration.\nflyway.out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("of"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("order是否允许无序的迁移，默认false.\nflyway.password目标数据库的密码.\nflyway.placeholder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prefix设置每个placeholder的前缀，默认$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".\nflyway.placeholder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("replacementplaceholders是否要被替换，默认true.\nflyway.placeholder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("suffix设置每个placeholder的后缀，默认"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".\nflyway.placeholders."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("placeholder name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("设置placeholder的value\nflyway.schemas设定需要flywary迁移的schema，大小写敏感，默认为连接默认的schema.\nflyway.sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("migration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prefix迁移文件的前缀，默认为V.\nflyway.sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("migration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("separator迁移脚本的文件名分隔符，默认__\nflyway.sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("migration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("suffix迁移脚本的后缀，默认为.sql\nflyway.tableflyway使用的元数据表名，默认为schema_version\nflyway.target迁移时使用的目标版本，默认为latest version\nflyway.url迁移时使用的JDBC URL，如果没有指定的话，将使用配置的主数据源\nflyway.user迁移数据库的用户名\nflyway.validate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("migrate迁移时是否校验，默认为true.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[a("code",[s._v("V")]),s._v("开头的脚本，内容不变运行，语句并不会执行，内容修改再运行，程序启动失败！")]),s._v(" "),a("p",[a("code",[s._v("R")]),s._v("开头的脚本，内容不变运行，语句并不会执行，内容修改过再运行，"),a("strong",[s._v("会将文件中的所有语句执行")]),s._v("！")]),s._v(" "),a("p",[s._v("每次程序启动会检验目前项目中的 sql 文件名称和文件夹名是否与数据库中存储的对应。"),a("br"),s._v("\n如果不对应则抛出相应的错误，程序启动失败。")]),s._v(" "),a("p",[a("code",[s._v("R")]),s._v("开头的脚本，更像是"),a("strong",[s._v("当前版本的一个临时补充的区域，为了及时修改当下紧急更新的内容")]),s._v("。")]),s._v(" "),a("p",[s._v("源代码地址：")]),s._v(" "),a("blockquote",[a("p",[s._v("https://github.com/rcbb-cc/fast-start-guide")])]),s._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_42300167/article/details/112417080",target:"_blank",rel:"noopener noreferrer"}},[s._v("flyway常用配置_Spring Boot 2 实战：使用 Flyway 管理你数据库的版本变更"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);